services:
  manager: &node
    privileged: true
    image: offen/docker-volume-backup:test-sandbox
    healthcheck:
      test: ["CMD", "docker", "info"]
      interval: 1s
      timeout: 5s
      retries: 50
    volumes:
      - $SOURCE:/code
      - $TARBALL:/cache/image.tar.gz
      - docker_volume_backup_test_sandbox_image:/var/lib/docker/image
      - docker_volume_backup_test_sandbox_overlay2:/var/lib/docker/overlay2

  worker1:
    <<: *node
    profiles:
      - multinode
  worker2:
    <<: *node
    profiles:
      - multinode

volumes:
  docker_volume_backup_test_sandbox_image:
  docker_volume_backup_test_sandbox_overlay2:
